name: CI â€” Lint & Validate

on:
  push:
  pull_request:

permissions:
  contents: read
  # for Super-Linter annotations
  checks: write
  statuses: write

jobs:
  superlinter:
    name: Super-Linter
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
        with:
          fetch-depth: 0

      - name: Super-Linter (blacklist)
        uses: github/super-linter/slim@v7
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEFAULT_BRANCH: main
          VALIDATE_ALL_CODEBASE: true

          # Diese willst du NICHT laufen lassen:
          VALIDATE_PYTHON: false
          VALIDATE_RUBY: false
          VALIDATE_GO: false
          VALIDATE_SHELL_SHFMT: false
          VALIDATE_BASH: false
          VALIDATE_MARKDOWN_PRETTIER: false
          VALIDATE_YAML_PRETTIER: false
          VALIDATE_ENV: false

  hadolint:
    name: Dockerfile Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Install hadolint
        run: |
          curl -sSfL https://github.com/hadolint/hadolint/releases/latest/download/hadolint-Linux-x86_64 -o /usr/local/bin/hadolint
          chmod +x /usr/local/bin/hadolint
      - name: Lint all Dockerfiles
        run: |
          set -e
          found=0
          while IFS= read -r -d '' f; do
            echo "==> hadolint $f"
            hadolint "$f"
            found=$((found+1))
          done < <(find . -type f -iname 'Dockerfile*' -print0)
          if [ "$found" -eq 0 ]; then
            echo "No Dockerfiles found"
          fi
